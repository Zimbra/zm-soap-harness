<t:tests xmlns:t="urn:zimbraTestHarness">

	<t:property name="test_account1.name"
		value="test1.${TIME}.${COUNTER}@${defaultdomain.name}" />
	<t:property name="test_account2.name"
		value="test2.${TIME}.${COUNTER}@${defaultdomain.name}" />
	<t:property name="test_account3.name"
		value="test3.${TIME}.${COUNTER}@${defaultdomain.name}" />
	<t:property name="test_account4.name"
		value="test4.${TIME}.${COUNTER}@${defaultdomain.name}" />
	<t:property name="test_account5.name"
		value="test5.${TIME}.${COUNTER}@${defaultdomain.name}" />
	<t:property name="test_account6.name"
		value="test6.${TIME}.${COUNTER}@${defaultdomain.name}" />
	<t:property name="test_account7.name"
		value="test7.${TIME}.${COUNTER}@${defaultdomain.name}" />
	<t:property name="test_account8.name"
		value="test8.${TIME}.${COUNTER}@${defaultdomain.name}" />
	<t:property name="test_account9.name"
		value="test9.${TIME}.${COUNTER}@${defaultdomain.name}" />
	<t:property name="test_account10.name"
		value="test10.${TIME}.${COUNTER}@${defaultdomain.name}" />
	<t:property name="test_account11.name"
		value="test11.${TIME}.${COUNTER}@${defaultdomain.name}" />
	<t:property name="test_account12.name"
		value="test12.${TIME}.${COUNTER}@${defaultdomain.name}" />
	<t:property name="test_account13.name"
		value="test13.${TIME}.${COUNTER}@${defaultdomain.name}" />
  <t:property name="test_account14.name"
        value="test14.${TIME}.${COUNTER}@${defaultdomain.name}" />
  <t:property name="test_account15.name"
        value="test15.${TIME}.${COUNTER}@${defaultdomain.name}" />
<t:property name="cos1.name" value="mycos1${TIME}${COUNTER}" />        
	<t:property name="mail_subject" value="subject.${TIME}.${COUNTER}" />
	<t:property name="mail_subject1" value="subject1.${TIME}.${COUNTER}" />
	<t:property name="mail_subject2" value="subject2.${TIME}.${COUNTER}" />
	<t:property name="mail_subject3" value="subject3.${TIME}.${COUNTER}" />
	<t:property name="mail_subject4" value="subject4.${TIME}.${COUNTER}" />
	<t:property name="mail_subject5" value="subject5.${TIME}.${COUNTER}" />
	<t:property name="mail_subject6" value="subject6.${TIME}.${COUNTER}" />
	<t:property name="mail_subject7" value="subject7.${TIME}.${COUNTER}" />
	<t:property name="mail_subject8" value="subject8.${TIME}.${COUNTER}" />
	<t:property name="mail_subject9" value="subject9.${TIME}.${COUNTER}" />
	<t:property name="mail_subject10" value="subject10.${TIME}.${COUNTER}" />
	<t:property name="mail_subject11" value="subject11.${TIME}.${COUNTER}" />
	<t:property name="mail_subject12" value="subject12.${TIME}.${COUNTER}" />
	<t:property name="mail_subject13" value="subject13.${TIME}.${COUNTER}" />
	<t:property name="mail_subject14" value="subject14.${TIME}.${COUNTER}" />
	<t:property name="mail_subject15" value="subject15.${TIME}.${COUNTER}" />
  <t:property name="mail_subject16" value="subject16.${TIME}.${COUNTER}" />


	<t:property name="msg01.file" value="${testMailRaw.root}/bug106870/mime01.txt" />
	<t:property name="msg02.file" value="${testMailRaw.root}/bug106870/mime02.txt" />


	<t:property name="sieve_rule1"
		value='require ["editheader","log"];
  deleteheader "X-Test-Header";
  log "Sieve rule 1"; 
 ' />

	<t:property name="sieve_rule2"
		value='require ["editheader","log"];
 deleteheader :index 2 "X-Test-Header";
 log "Sieve rule 2";
 ' />

	<t:property name="sieve_rule3"
		value='require ["editheader","log"];
     deleteheader :last :index 1 "X-Test-Header";
     log "Sieve rule 3";
 ' />

	<t:property name="sieve_rule4"
		value='require ["editheader","log"];
      deleteheader :index 2 :last "X-Test-Header";
      log "Sieve rule 4";
 ' />

	<t:property name="sieve_rule5"
		value='require ["editheader","log"];
 	  deleteheader :is "X-Test-Header" ["Random1", "Random2"];
 	  log "Sieve rule 5";
 ' />

	<t:property name="sieve_rule6"
		value='require ["editheader","log"];
      deleteheader :matches "X-Test-Header" "Ran*";
      log "Sieve rule 6";
 ' />

	<t:property name="sieve_rule7"
		value='require ["editheader","log"];
      deleteheader :contains "X-Test-Header" "Random";
      log "Sieve rule 7";
 ' />

	<t:property name="sieve_rule8"
		value='require ["editheader","log", "comparator-i;ascii-numeric", "relational"];
      deleteheader :value "lt" :comparator "i;ascii-numeric" "X-Numeric-Header" "3";
      log "Sieve rule 8";
 ' />

	<t:property name="sieve_rule9"
		value='require ["editheader","log", "comparator-i;ascii-numeric", "relational"];
      deleteheader :count "ge" :comparator "i;ascii-numeric" "X-Numeric-Header" "3";
      log "Sieve rule 9";
 ' />

	<t:property name="sieve_rule10"
		value='require ["editheader","log"];
      deleteheader :index 2 :last :contains "X-Test-Header" "1";
      log "Sieve rule 10";
 ' />

	<t:property name="sieve_rule11"
		value='require ["editheader","log"];
      deleteheader :contains "X-Test-Header" "2";
      addheader :last "X-Test-Header" "Random5";
      log "Sieve rule 11";
 ' />

	<t:property name="sieve_rule12"
		value='require ["editheader","log"];
      addheader :last "X-Test-Header" "Random6";
      deleteheader :contains "X-Test-Header" "2";
      log "Sieve rule 12";
 ' />

	<t:property name="sieve_rule13"
		value='require ["editheader","log"];
     addheader :last "X-Test-Header" "Random7";
     deleteheader :contains "X-Test-Header" "2";
     addheader :last "X-Test-Header" "Random8";
     log "Sieve rule 13";
 ' />

	<t:property name="sieve_rule14"
		value='require ["editheader","log"];
     deleteheader :contains "X-Sieve-Header1" "Oldval3";
     log "Sieve rule 14";
 ' />
 
  <t:property name="sieve_rule15"
    value='require ["editheader","log"];
      deleteheader  "X-Test-Header" ;
      log "Sieve rule 15";
 ' />
 
 <t:property name="sieve_rule16"
    value='require ["editheader","log", "comparator-i;ascii-numeric", "relational"];
      deleteheader :count "ge" :comparator "i;ascii-numeric" "X-Test-Header" "";
      log "Sieve rule 16";
 ' />


	<t:property name="server.zimbraAdmin" value="${zimbraServer.name}" />

	<t:test_case testcaseid="Ping" type="always">
		<t:objective>basic system check</t:objective>

		<t:test required="true">
			<t:request>
				<PingRequest xmlns="urn:zimbraAdmin" />
			</t:request>
			<t:response>
				<t:select path="//admin:PingResponse" />
			</t:response>
		</t:test>

	</t:test_case>

	<t:test_case testcaseid="acctSetup1" type="always">
		<t:objective>create test account</t:objective>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

        <t:test id="CreateCosRequest1">
            <t:request>
                <CreateCosRequest xmlns="urn:zimbraAdmin">
                    <name xmlns="">${cos1.name}</name>
                </CreateCosRequest>
            </t:request>
            <t:response>
                <t:select path="//admin:CreateCosResponse/admin:cos" attr="name" match="${cos1.name}" />
                <t:select path="//admin:CreateCosResponse/admin:cos" attr="id" set="cos1.id" />
            </t:response>
        </t:test>

	    <t:test>
	        <t:request>
	            <ModifyCosRequest xmlns="urn:zimbraAdmin">
	                <id>${cos1.id}</id>
	                <a n="zimbraSieveEditHeaderEnabled">TRUE</a>
	            </ModifyCosRequest>
	        </t:request>
	        <t:response>
	            <t:select path="//admin:ModifyCosResponse/admin:cos"/>            
	        </t:response>
	    </t:test>
	    
		<t:test required="true">
			<t:request>
				<CreateAccountRequest xmlns="urn:zimbraAdmin">
					<name>${test_account1.name}</name>
					<password>${defaultpassword.value}</password>
					<a n="zimbraCOSId">${cos1.id}</a>
				</CreateAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:CreateAccountResponse/admin:account"
					attr="id" set="test_account1.id" />
				<t:select
					path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
					set="test_acct1.server" />
			</t:response>
		</t:test>

		<t:test required="true">
			<t:request>
				<CreateAccountRequest xmlns="urn:zimbraAdmin">
					<name>${test_account2.name}</name>
					<password>${defaultpassword.value}</password>
					<a n="zimbraCOSId">${cos1.id}</a>
				</CreateAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:CreateAccountResponse/admin:account"
					attr="id" set="test_account2.id" />
				<t:select
					path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
					set="test_acct2.server" />
			</t:response>
		</t:test>

		<t:test required="true">
			<t:request>
				<CreateAccountRequest xmlns="urn:zimbraAdmin">
					<name>${test_account3.name}</name>
					<password>${defaultpassword.value}</password>
					<a n="zimbraCOSId">${cos1.id}</a>
				</CreateAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:CreateAccountResponse/admin:account"
					attr="id" set="test_account3.id" />
				<t:select
					path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
					set="test_acct3.server" />
			</t:response>
		</t:test>
		<t:test required="true">
			<t:request>
				<CreateAccountRequest xmlns="urn:zimbraAdmin">
					<name>${test_account4.name}</name>
					<password>${defaultpassword.value}</password>
					<a n="zimbraCOSId">${cos1.id}</a>
				</CreateAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:CreateAccountResponse/admin:account"
					attr="id" set="test_account4.id" />
				<t:select
					path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
					set="test_acct4.server" />
			</t:response>
		</t:test>
		<t:test required="true">
			<t:request>
				<CreateAccountRequest xmlns="urn:zimbraAdmin">
					<name>${test_account5.name}</name>
					<password>${defaultpassword.value}</password>
					<a n="zimbraCOSId">${cos1.id}</a>
				</CreateAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:CreateAccountResponse/admin:account"
					attr="id" set="test_account5.id" />
				<t:select
					path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
					set="test_acct5.server" />
			</t:response>
		</t:test>
		<t:test required="true">
			<t:request>
				<CreateAccountRequest xmlns="urn:zimbraAdmin">
					<name>${test_account6.name}</name>
					<password>${defaultpassword.value}</password>
					<a n="zimbraCOSId">${cos1.id}</a>
				</CreateAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:CreateAccountResponse/admin:account"
					attr="id" set="test_account6.id" />
				<t:select
					path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
					set="test_acct6.server" />
			</t:response>
		</t:test>
		<t:test required="true">
			<t:request>
				<CreateAccountRequest xmlns="urn:zimbraAdmin">
					<name>${test_account7.name}</name>
					<password>${defaultpassword.value}</password>
					<a n="zimbraCOSId">${cos1.id}</a>
				</CreateAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:CreateAccountResponse/admin:account"
					attr="id" set="test_account7.id" />
				<t:select
					path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
					set="test_acct7.server" />
			</t:response>
		</t:test>

		<t:test required="true">
			<t:request>
				<CreateAccountRequest xmlns="urn:zimbraAdmin">
					<name>${test_account8.name}</name>
					<password>${defaultpassword.value}</password>
					<a n="zimbraCOSId">${cos1.id}</a>
				</CreateAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:CreateAccountResponse/admin:account"
					attr="id" set="test_account8.id" />
				<t:select
					path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
					set="test_acct8.server" />
			</t:response>
		</t:test>

		<t:test required="true">
			<t:request>
				<CreateAccountRequest xmlns="urn:zimbraAdmin">
					<name>${test_account9.name}</name>
					<password>${defaultpassword.value}</password>
					<a n="zimbraCOSId">${cos1.id}</a>
				</CreateAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:CreateAccountResponse/admin:account"
					attr="id" set="test_account9.id" />
				<t:select
					path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
					set="test_acct9.server" />
			</t:response>
		</t:test>

		<t:test required="true">
			<t:request>
				<CreateAccountRequest xmlns="urn:zimbraAdmin">
					<name>${test_account10.name}</name>
					<password>${defaultpassword.value}</password>
					<a n="zimbraCOSId">${cos1.id}</a>
				</CreateAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:CreateAccountResponse/admin:account"
					attr="id" set="test_account10.id" />
				<t:select
					path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
					set="test_acct10.server" />
			</t:response>
		</t:test>

		<t:test required="true">
			<t:request>
				<CreateAccountRequest xmlns="urn:zimbraAdmin">
					<name>${test_account11.name}</name>
					<password>${defaultpassword.value}</password>
					<a n="zimbraCOSId">${cos1.id}</a>
				</CreateAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:CreateAccountResponse/admin:account"
					attr="id" set="test_account11.id" />
				<t:select
					path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
					set="test_acct11.server" />
			</t:response>
		</t:test>

		<t:test required="true">
			<t:request>
				<CreateAccountRequest xmlns="urn:zimbraAdmin">
					<name>${test_account12.name}</name>
					<password>${defaultpassword.value}</password>
					<a n="zimbraCOSId">${cos1.id}</a>
				</CreateAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:CreateAccountResponse/admin:account"
					attr="id" set="test_account12.id" />
				<t:select
					path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
					set="test_acct12.server" />
			</t:response>
		</t:test>
		
		<t:test required="true">
			<t:request>
				<CreateAccountRequest xmlns="urn:zimbraAdmin">
					<name>${test_account13.name}</name>
					<password>${defaultpassword.value}</password>
					<a n="zimbraCOSId">${cos1.id}</a>
				</CreateAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:CreateAccountResponse/admin:account"
					attr="id" set="test_account13.id" />
				<t:select
					path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
					set="test_acct13.server" />
			    <t:select
			        path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraSieveImmutableHeaders"]'
			        set="defaultzimbraSieveImmutableHeaders" />
			</t:response>
		</t:test>
  
    <t:test required="true">
            <t:request>
                <CreateAccountRequest xmlns="urn:zimbraAdmin">
                    <name>${test_account14.name}</name>
                    <password>${defaultpassword.value}</password>
                    <a n="zimbraCOSId">${cos1.id}</a>
                </CreateAccountRequest>
            </t:request>
            <t:response>
                <t:select path="//admin:CreateAccountResponse/admin:account"
                    attr="id" set="test_account14.id" />
                <t:select
                    path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
                    set="test_acct14.server" />
            </t:response>
        </t:test>
        <t:test required="true">
            <t:request>
                <CreateAccountRequest xmlns="urn:zimbraAdmin">
                    <name>${test_account15.name}</name>
                    <password>${defaultpassword.value}</password>
                    <a n="zimbraCOSId">${cos1.id}</a>
                </CreateAccountRequest>
            </t:request>
            <t:response>
                <t:select path="//admin:CreateAccountResponse/admin:account"
                    attr="id" set="test_account15.id" />
                <t:select
                    path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]'
                    set="test_acct15.server" />
            </t:response>
        </t:test>
  

	</t:test_case>


	<t:test_case testcaseid="bug106870_SieveRule1" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>

		<t:test>
			<t:request>
				<ModifyConfigRequest xmlns="urn:zimbraAdmin">
					<a n="zimbraCustomMimeHeaderNameAllowed">X-Test-Header</a>
					<a n="zimbraCustomMimeHeaderNameAllowed">X-Numeric-Header</a>					
				</ModifyConfigRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyConfigResponse" />
			</t:response>
		</t:test>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account1.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule1}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SendMsgRequest xmlns="urn:zimbraMail">
					<m>
						<header name="X-Test-Header">Random</header>
						<e t="t" a='${test_account1.name}' />
						<su>sub123</su>
						<mp ct="text/plain">
							<content>Good Morning</content>
						</mp>
					</m>
				</SendMsgRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SendMsgResponse/mail:m" attr="id"
					set="msg1.id" />
			</t:response>
		</t:test>
		
		   <t:delay msec="5000" />
		   
		<t:resttest>
			<t:restServletRequest>
				<id>${msg1.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Test-Header" match="Random" />
			</t:restServletResponse>
		</t:resttest>
	</t:test_case>

	<t:test_case testcaseid="bug106870_SieveRule2" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account1.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule2}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:mailinjecttest>
			<t:lmtpInjectRequest>
				<filename>${msg01.file}</filename>
				<to>${test_account1.name}</to>
				<from>${admin.user}</from>
				<server>${test_acct1.server}</server>
				<modify>
					<header a="To">${test_account1.name}</header>
					<header a="From">${admin.user}</header>
					<header a="Subject">${mail_subject}</header>
				</modify>
			</t:lmtpInjectRequest>
		</t:mailinjecttest>
	
		   <t:delay msec="5000" />
		   
		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
					<account by="name">${test_account1.name}</account>
					<password>${defaultpassword.value}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SearchRequest xmlns="urn:zimbraMail" types="message">
					<query>subject:${mail_subject}</query>
				</SearchRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SearchResponse/mail:m/mail:su"
					match="${mail_subject}" />
				<t:select path="//mail:SearchResponse/mail:m" attr="id"
					set="msg2.id" />
			</t:response>
		</t:test>

		<t:resttest>
			<t:restServletRequest>
				<id>${msg2.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Test-Header" match="Random1" emptyset="1" />
				<t:select attr="X-Test-Header" match="Random" />
			</t:restServletResponse>
		</t:resttest>

	</t:test_case>

	<t:test_case testcaseid="bug106870_SieveRule3" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account2.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule3}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:mailinjecttest>
			<t:lmtpInjectRequest>
				<filename>${msg01.file}</filename>
				<to>${test_account2.name}</to>
				<from>${admin.user}</from>
				<server>${test_acct2.server}</server>
				<modify>
					<header a="To">${test_account2.name}</header>
					<header a="From">${admin.user}</header>
					<header a="Subject">${mail_subject1}</header>
				</modify>
			</t:lmtpInjectRequest>
		</t:mailinjecttest>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
					<account by="name">${test_account2.name}</account>
					<password>${defaultpassword.value}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SearchRequest xmlns="urn:zimbraMail" types="message">
					<query>subject:${mail_subject1}</query>
				</SearchRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SearchResponse/mail:m/mail:su"
					match="${mail_subject1}" />
				<t:select path="//mail:SearchResponse/mail:m" attr="id"
					set="msg3.id" />
			</t:response>
		</t:test>

		<t:resttest>
			<t:restServletRequest>
				<id>${msg3.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Test-Header" match="Random2" emptyset="1" />
				<t:select attr="X-Test-Header" match="Random" />
			</t:restServletResponse>
		</t:resttest>

	</t:test_case>

	<t:test_case testcaseid="bug106870_SieveRule4" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account3.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule4}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:mailinjecttest>
			<t:lmtpInjectRequest>
				<filename>${msg01.file}</filename>
				<to>${test_account3.name}</to>
				<from>${admin.user}</from>
				<server>${test_acct3.server}</server>
				<modify>
					<header a="To">${test_account3.name}</header>
					<header a="From">${admin.user}</header>
					<header a="Subject">${mail_subject2}</header>
				</modify>
			</t:lmtpInjectRequest>
		</t:mailinjecttest>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
					<account by="name">${test_account3.name}</account>
					<password>${defaultpassword.value}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SearchRequest xmlns="urn:zimbraMail" types="message">
					<query>subject:${mail_subject2}</query>
				</SearchRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SearchResponse/mail:m/mail:su"
					match="${mail_subject2}" />
				<t:select path="//mail:SearchResponse/mail:m" attr="id"
					set="msg5.id" />
			</t:response>
		</t:test>

		<t:resttest>
			<t:restServletRequest>
				<id>${msg5.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Test-Header" match="Random1" emptyset="1" />
				<t:select attr="X-Test-Header" match="Random2" />
			</t:restServletResponse>
		</t:resttest>

	</t:test_case>

	<t:test_case testcaseid="bug106870_SieveRule5" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account4.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule5}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:mailinjecttest>
			<t:lmtpInjectRequest>
				<filename>${msg01.file}</filename>
				<to>${test_account4.name}</to>
				<from>${admin.user}</from>
				<server>${test_acct4.server}</server>
				<modify>
					<header a="To">${test_account4.name}</header>
					<header a="From">${admin.user}</header>
					<header a="Subject">${mail_subject4}</header>
				</modify>
			</t:lmtpInjectRequest>
		</t:mailinjecttest>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
					<account by="name">${test_account4.name}</account>
					<password>${defaultpassword.value}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SearchRequest xmlns="urn:zimbraMail" types="message">
					<query>subject:${mail_subject4}</query>
				</SearchRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SearchResponse/mail:m/mail:su"
					match="${mail_subject4}" />
				<t:select path="//mail:SearchResponse/mail:m" attr="id"
					set="msg6.id" />
			</t:response>
		</t:test>

		<t:resttest>
			<t:restServletRequest>
				<id>${msg6.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Test-Header" match="Random2" emptyset="1" />
				<t:select attr="X-Test-Header" match="Random1" emptyset="1" />
				<t:select attr="X-Test-Header" match="Random" />
			</t:restServletResponse>
		</t:resttest>

	</t:test_case>

	<t:test_case testcaseid="bug106870_SieveRule6" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account5.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule6}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:mailinjecttest>
			<t:lmtpInjectRequest>
				<filename>${msg01.file}</filename>
				<to>${test_account5.name}</to>
				<from>${admin.user}</from>
				<server>${test_acct5.server}</server>
				<modify>
					<header a="To">${test_account5.name}</header>
					<header a="From">${admin.user}</header>
					<header a="Subject">${mail_subject5}</header>
				</modify>
			</t:lmtpInjectRequest>
		</t:mailinjecttest>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
					<account by="name">${test_account5.name}</account>
					<password>${defaultpassword.value}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SearchRequest xmlns="urn:zimbraMail" types="message">
					<query>subject:${mail_subject5}</query>
				</SearchRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SearchResponse/mail:m/mail:su"
					match="${mail_subject5}" />
				<t:select path="//mail:SearchResponse/mail:m" attr="id"
					set="msg7.id" />
			</t:response>
		</t:test>

		<t:resttest>
			<t:restServletRequest>
				<id>${msg7.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Test-Header" match="Random2" emptyset="1" />
				<t:select attr="X-Test-Header" match="Random1" emptyset="1" />
				<t:select attr="X-Test-Header" match="Random" emptyset="1" />
			</t:restServletResponse>
		</t:resttest>

	</t:test_case>

	<t:test_case testcaseid="bug106870_SieveRule7" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account6.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule7}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:mailinjecttest>
			<t:lmtpInjectRequest>
				<filename>${msg01.file}</filename>
				<to>${test_account6.name}</to>
				<from>${admin.user}</from>
				<server>${test_acct6.server}</server>
				<modify>
					<header a="To">${test_account6.name}</header>
					<header a="From">${admin.user}</header>
					<header a="Subject">${mail_subject6}</header>
				</modify>
			</t:lmtpInjectRequest>
		</t:mailinjecttest>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
					<account by="name">${test_account6.name}</account>
					<password>${defaultpassword.value}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SearchRequest xmlns="urn:zimbraMail" types="message">
					<query>subject:${mail_subject6}</query>
				</SearchRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SearchResponse/mail:m/mail:su"
					match="${mail_subject6}" />
				<t:select path="//mail:SearchResponse/mail:m" attr="id"
					set="msg8.id" />
			</t:response>
		</t:test>

		<t:resttest>
			<t:restServletRequest>
				<id>${msg8.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Test-Header" emptyset="1" />
			</t:restServletResponse>
		</t:resttest>

	</t:test_case>

	<t:test_case testcaseid="bug106870_SieveRule8" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account7.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule8}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:mailinjecttest>
			<t:lmtpInjectRequest>
				<filename>${msg02.file}</filename>
				<to>${test_account7.name}</to>
				<from>${admin.user}</from>
				<server>${test_acct7.server}</server>
				<modify>
					<header a="To">${test_account7.name}</header>
					<header a="From">${admin.user}</header>
					<header a="Subject">${mail_subject7}</header>
				</modify>
			</t:lmtpInjectRequest>
		</t:mailinjecttest>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
					<account by="name">${test_account7.name}</account>
					<password>${defaultpassword.value}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SearchRequest xmlns="urn:zimbraMail" types="message">
					<query>subject:${mail_subject7}</query>
				</SearchRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SearchResponse/mail:m/mail:su"
					match="${mail_subject7}" />
				<t:select path="//mail:SearchResponse/mail:m" attr="id"
					set="msg9.id" />
			</t:response>
		</t:test>

		<t:resttest>
			<t:restServletRequest>
				<id>${msg9.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Numeric-Header" match="1" emptyset="1" />
				<t:select attr="X-Numeric-Header" match="2" emptyset="1" />
				<t:select attr="X-Numeric-Header" match="3" />
			</t:restServletResponse>
		</t:resttest>

	</t:test_case>

	<t:test_case testcaseid="bug106870_SieveRule9" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account8.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule9}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:mailinjecttest>
			<t:lmtpInjectRequest>
				<filename>${msg02.file}</filename>
				<to>${test_account8.name}</to>
				<from>${admin.user}</from>
				<server>${test_acct8.server}</server>
				<modify>
					<header a="To">${test_account8.name}</header>
					<header a="From">${admin.user}</header>
					<header a="Subject">${mail_subject8}</header>
				</modify>
			</t:lmtpInjectRequest>
		</t:mailinjecttest>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
					<account by="name">${test_account8.name}</account>
					<password>${defaultpassword.value}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SearchRequest xmlns="urn:zimbraMail" types="message">
					<query>subject:${mail_subject8}</query>
				</SearchRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SearchResponse/mail:m/mail:su"
					match="${mail_subject8}" />
				<t:select path="//mail:SearchResponse/mail:m" attr="id"
					set="msg10.id" />
			</t:response>
		</t:test>

		<t:resttest>
			<t:restServletRequest>
				<id>${msg10.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Numeric-Header" emptyset="1" />
			</t:restServletResponse>
		</t:resttest>

	</t:test_case>

	<t:test_case testcaseid="bug106870_SieveRule10" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account9.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule10}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:mailinjecttest>
			<t:lmtpInjectRequest>
				<filename>${msg01.file}</filename>
				<to>${test_account9.name}</to>
				<from>${admin.user}</from>
				<server>${test_acct9.server}</server>
				<modify>
					<header a="To">${test_account9.name}</header>
					<header a="From">${admin.user}</header>
					<header a="Subject">${mail_subject9}</header>
				</modify>
			</t:lmtpInjectRequest>
		</t:mailinjecttest>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
					<account by="name">${test_account9.name}</account>
					<password>${defaultpassword.value}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SearchRequest xmlns="urn:zimbraMail" types="message">
					<query>subject:${mail_subject9}</query>
				</SearchRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SearchResponse/mail:m/mail:su"
					match="${mail_subject9}" />
				<t:select path="//mail:SearchResponse/mail:m" attr="id"
					set="msg11.id" />
			</t:response>
		</t:test>

		<t:resttest>
			<t:restServletRequest>
				<id>${msg11.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Test-Header" match="Random1" emptyset="1" />
			</t:restServletResponse>
		</t:resttest>

	</t:test_case>

	<t:test_case testcaseid="bug106870_SieveRule11" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account10.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule11}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:mailinjecttest>
			<t:lmtpInjectRequest>
				<filename>${msg01.file}</filename>
				<to>${test_account10.name}</to>
				<from>${admin.user}</from>
				<server>${test_acct10.server}</server>
				<modify>
					<header a="To">${test_account10.name}</header>
					<header a="From">${admin.user}</header>
					<header a="Subject">${mail_subject10}</header>
				</modify>
			</t:lmtpInjectRequest>
		</t:mailinjecttest>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
					<account by="name">${test_account10.name}</account>
					<password>${defaultpassword.value}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SearchRequest xmlns="urn:zimbraMail" types="message">
					<query>subject:${mail_subject10}</query>
				</SearchRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SearchResponse/mail:m/mail:su"
					match="${mail_subject10}" />
				<t:select path="//mail:SearchResponse/mail:m" attr="id"
					set="msg12.id" />
			</t:response>
		</t:test>

		<t:resttest>
			<t:restServletRequest>
				<id>${msg12.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Test-Header" match="Random2" emptyset="1" />
				<t:select attr="X-Test-Header" match="Random5" />
			</t:restServletResponse>
		</t:resttest>

	</t:test_case>

	<t:test_case testcaseid="bug106870_SieveRule12" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account11.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule12}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:mailinjecttest>
			<t:lmtpInjectRequest>
				<filename>${msg01.file}</filename>
				<to>${test_account11.name}</to>
				<from>${admin.user}</from>
				<server>${test_acct11.server}</server>
				<modify>
					<header a="To">${test_account11.name}</header>
					<header a="From">${admin.user}</header>
					<header a="Subject">${mail_subject12}</header>
				</modify>
			</t:lmtpInjectRequest>
		</t:mailinjecttest>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
					<account by="name">${test_account11.name}</account>
					<password>${defaultpassword.value}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SearchRequest xmlns="urn:zimbraMail" types="message">
					<query>subject:${mail_subject12}</query>
				</SearchRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SearchResponse/mail:m/mail:su"
					match="${mail_subject12}" />
				<t:select path="//mail:SearchResponse/mail:m" attr="id"
					set="msg13.id" />
			</t:response>
		</t:test>

		<t:resttest>
			<t:restServletRequest>
				<id>${msg13.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Test-Header" match="Random2" emptyset="1" />
				<t:select attr="X-Test-Header" match="Random6" />
			</t:restServletResponse>
		</t:resttest>

	</t:test_case>

	<t:test_case testcaseid="bug106870_SieveRule13" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account12.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule13}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:mailinjecttest>
			<t:lmtpInjectRequest>
				<filename>${msg01.file}</filename>
				<to>${test_account12.name}</to>
				<from>${admin.user}</from>
				<server>${test_acct12.server}</server>
				<modify>
					<header a="To">${test_account12.name}</header>
					<header a="From">${admin.user}</header>
					<header a="Subject">${mail_subject13}</header>
				</modify>
			</t:lmtpInjectRequest>
		</t:mailinjecttest>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
					<account by="name">${test_account12.name}</account>
					<password>${defaultpassword.value}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SearchRequest xmlns="urn:zimbraMail" types="message">
					<query>subject:${mail_subject13}</query>
				</SearchRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SearchResponse/mail:m/mail:su"
					match="${mail_subject13}" />
				<t:select path="//mail:SearchResponse/mail:m" attr="id"
					set="msg14.id" />
			</t:response>
		</t:test>

		<t:resttest>
			<t:restServletRequest>
				<id>${msg14.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Test-Header" match="Random2" emptyset="1" />
				<t:select attr="X-Test-Header" match="Random7" />
				<t:select attr="X-Test-Header" match="Random8" />
			</t:restServletResponse>
		</t:resttest>

	</t:test_case>
	
	<t:test_case testcaseid="bug106870_SieveRule14" type="smoke"
		bugids="106870">
		<t:objective>Add a sieve rule to delete custom header and verify the
			mime via rest servlet</t:objective>
		
		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>
		
	    <t:test>
	        <t:request>
	            <ModifyCosRequest xmlns="urn:zimbraAdmin">
	                <id>${cos1.id}</id>
	                <a n="zimbraSieveImmutableHeaders">${defaultzimbraSieveImmutableHeaders},X-Sieve-Header1</a>
	            </ModifyCosRequest>
	        </t:request>
	        <t:response>
	            <t:select path="//admin:ModifyCosResponse/admin:cos"/>            
	        </t:response>
	    </t:test>
		
		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test id="modifyaccountrequest01">
			<t:request>
				<ModifyAccountRequest xmlns="urn:zimbraAdmin">
					<id>${test_account13.id}</id>
					<a n="zimbraAdminSieveScriptBefore">${sieve_rule14}</a>
				</ModifyAccountRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:ModifyAccountResponse/admin:account" />
			</t:response>
		</t:test>

		<t:mailinjecttest>
			<t:lmtpInjectRequest>
				<filename>${msg01.file}</filename>
				<to>${test_account13.name}</to>
				<from>${admin.user}</from>
				<server>${test_acct13.server}</server>
				<modify>
					<header a="To">${test_account13.name}</header>
					<header a="From">${admin.user}</header>
					<header a="Subject">${mail_subject14}</header>
				</modify>
			</t:lmtpInjectRequest>
		</t:mailinjecttest>

		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
					<account by="name">${test_account13.name}</account>
					<password>${defaultpassword.value}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
			</t:response>
		</t:test>

		<t:test>
			<t:request>
				<SearchRequest xmlns="urn:zimbraMail" types="message">
					<query>subject:${mail_subject14}</query>
				</SearchRequest>
			</t:request>
			<t:response>
				<t:select path="//mail:SearchResponse/mail:m/mail:su"
					match="${mail_subject14}" />
				<t:select path="//mail:SearchResponse/mail:m" attr="id"
					set="msg15.id" />
			</t:response>
		</t:test>

		<t:resttest>
			<t:restServletRequest>
				<id>${msg15.id}</id>
			</t:restServletRequest>
			<t:restServletResponse>
				<t:select attr="X-Sieve-Header1" match="Oldval3" />
			</t:restServletResponse>
		</t:resttest>
		
		<t:test required="true">
			<t:request>
				<AuthRequest xmlns="urn:zimbraAdmin">
					<name>${admin.user}</name>
					<password>${admin.password}</password>
				</AuthRequest>
			</t:request>
			<t:response>
				<t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
			</t:response>
		</t:test>

	    <t:test>
	        <t:request>
	            <ModifyCosRequest xmlns="urn:zimbraAdmin">
	                <id>${cos1.id}</id>
	                <a n="zimbraSieveImmutableHeaders">${defaultzimbraSieveImmutableHeaders}</a>
	            </ModifyCosRequest>
	        </t:request>
	        <t:response>
	            <t:select path="//admin:ModifyCosResponse/admin:cos"/>            
	        </t:response>
	    </t:test>
		
	</t:test_case>
 
 
  <!-- ZCS-859 -->
  <t:test_case testcaseid="bugZCS-859" type="smoke"
    bugids="ZCS-859">
    <t:objective>Add a sieve rule to delete custom header and verify the
      mime via rest servlet</t:objective>

    <t:test required="true">
      <t:request>
        <AuthRequest xmlns="urn:zimbraAdmin">
          <name>${admin.user}</name>
          <password>${admin.password}</password>
        </AuthRequest>
      </t:request>
      <t:response>
        <t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
      </t:response>
    </t:test>

    <t:test id="modifyaccountrequest01">
      <t:request>
        <ModifyAccountRequest xmlns="urn:zimbraAdmin">
          <id>${test_account8.id}</id>
          <a n="zimbraAdminSieveScriptBefore">${sieve_rule15}</a>
        </ModifyAccountRequest>
      </t:request>
      <t:response>
        <t:select path="//admin:ModifyAccountResponse/admin:account" />
      </t:response>
    </t:test>

    <t:mailinjecttest>
      <t:lmtpInjectRequest>
        <filename>${msg02.file}</filename>
        <to>${test_account8.name}</to>
        <from>${admin.user}</from>
        <server>${test_acct8.server}</server>
        <modify>
          <header a="To">${test_account8.name}</header>
          <header a="From">${admin.user}</header>
          <header a="Subject">${mail_subject8}</header>
        </modify>
      </t:lmtpInjectRequest>
    </t:mailinjecttest>

    <t:test required="true">
      <t:request>
        <AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
          <account by="name">${test_account8.name}</account>
          <password>${defaultpassword.value}</password>
        </AuthRequest>
      </t:request>
      <t:response>
        <t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
      </t:response>
    </t:test>

    <t:test>
      <t:request>
        <SearchRequest xmlns="urn:zimbraMail" types="message">
          <query>subject:${mail_subject8}</query>
        </SearchRequest>
      </t:request>
      <t:response>
        <t:select path="//mail:SearchResponse/mail:m/mail:su"
          match="${mail_subject8}" />
        <t:select path="//mail:SearchResponse/mail:m" attr="id"
          set="msg10.id" />
      </t:response>
    </t:test>

    <t:resttest>
      <t:restServletRequest>
        <id>${msg10.id}</id>
      </t:restServletRequest>
      <t:restServletResponse>
        <t:select attr="X-Numeric-Header" emptyset="1" />
      </t:restServletResponse>
    </t:resttest>

  </t:test_case>
  
     <!-- ZCS-859 -->
  <t:test_case testcaseid="bugZCS-859_15" type="smoke"
    bugids="ZCS-859">
    <t:objective>Add a sieve rule to delete custom header and verify the
      mime via rest servlet</t:objective>

    <t:test required="true">
      <t:request>
        <AuthRequest xmlns="urn:zimbraAdmin">
          <name>${admin.user}</name>
          <password>${admin.password}</password>
        </AuthRequest>
      </t:request>
      <t:response>
        <t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
      </t:response>
    </t:test>

    <t:test id="modifyaccountrequest01">
      <t:request>
        <ModifyAccountRequest xmlns="urn:zimbraAdmin">
          <id>${test_account14.id}</id>
          <a n="zimbraAdminSieveScriptBefore">${sieve_rule15}</a>
        </ModifyAccountRequest>
      </t:request>
      <t:response>
        <t:select path="//admin:ModifyAccountResponse/admin:account" />
      </t:response>
    </t:test>

    <t:mailinjecttest>
      <t:lmtpInjectRequest>
        <filename>${msg02.file}</filename>
        <to>${test_account14.name}</to>
        <from>${admin.user}</from>
        <server>${test_acct14.server}</server>
        <modify>
          <header a="To">${test_account14.name}</header>
          <header a="From">${admin.user}</header>
          <header a="Subject">${mail_subject15}</header>
        </modify>
      </t:lmtpInjectRequest>
    </t:mailinjecttest>

    <t:test required="true">
      <t:request>
        <AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
          <account by="name">${test_account14.name}</account>
          <password>${defaultpassword.value}</password>
        </AuthRequest>
      </t:request>
      <t:response>
        <t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
      </t:response>
    </t:test>
    
  <t:delay msec="5000" />
  
    <t:test>
      <t:request>
        <SearchRequest xmlns="urn:zimbraMail" types="message">
          <query>subject:${mail_subject15}</query>
        </SearchRequest>
      </t:request>
      <t:response>
        <t:select path="//mail:SearchResponse/mail:m/mail:su"
          match="${mail_subject15}" />
        <t:select path="//mail:SearchResponse/mail:m" attr="id"
          set="msg15.id" />
      </t:response>
    </t:test>

    <t:resttest>
      <t:restServletRequest>
        <id>${msg15.id}</id>
      </t:restServletRequest>
      <t:restServletResponse>
        <t:select attr="X-Test-Header" emptyset="1" />
      </t:restServletResponse>
    </t:resttest>

  </t:test_case>
  
  
  <t:test_case testcaseid="bugZCS-859_16" type="smoke"
    bugids="ZCS-859">
    <t:objective>Add a sieve rule to delete custom header and verify the
      mime via rest servlet</t:objective>

    <t:test required="true">
      <t:request>
        <AuthRequest xmlns="urn:zimbraAdmin">
          <name>${admin.user}</name>
          <password>${admin.password}</password>
        </AuthRequest>
      </t:request>
      <t:response>
        <t:select path="//admin:AuthResponse/admin:authToken" set="authToken" />
      </t:response>
    </t:test>

    <t:test id="modifyaccountrequest01">
      <t:request>
        <ModifyAccountRequest xmlns="urn:zimbraAdmin">
          <id>${test_account15.id}</id>
          <a n="zimbraAdminSieveScriptBefore">${sieve_rule16}</a>
        </ModifyAccountRequest>
      </t:request>
      <t:response>
        <t:select path="//admin:ModifyAccountResponse/admin:account" />
      </t:response>
    </t:test>

    <t:mailinjecttest>
      <t:lmtpInjectRequest>
        <filename>${msg02.file}</filename>
        <to>${test_account15.name}</to>
        <from>${admin.user}</from>
        <server>${test_acct15.server}</server>
        <modify>
          <header a="To">${test_account15.name}</header>
          <header a="From">${admin.user}</header>
          <header a="Subject">${mail_subject16}</header>
        </modify>
      </t:lmtpInjectRequest>
    </t:mailinjecttest>

    <t:test required="true">
      <t:request>
        <AuthRequest xmlns="urn:zimbraAccount" csrfTokenSecured="0">
          <account by="name">${test_account15.name}</account>
          <password>${defaultpassword.value}</password>
        </AuthRequest>
      </t:request>
      <t:response>
        <t:select path="//acct:AuthResponse/acct:authToken" set="authToken" />
      </t:response>
    </t:test>
    
  <t:delay msec="10000" />
  
    <t:test>
      <t:request>
        <SearchRequest xmlns="urn:zimbraMail" types="message">
          <query>subject:${mail_subject16}</query>
        </SearchRequest>
      </t:request>
      <t:response>
        <t:select path="//mail:SearchResponse/mail:m/mail:su"
          match="${mail_subject16}" />
        <t:select path="//mail:SearchResponse/mail:m" attr="id"
          set="msg16.id" />
      </t:response>
    </t:test>

    <t:resttest>
      <t:restServletRequest>
        <id>${msg16.id}</id>
      </t:restServletRequest>
      <t:restServletResponse>
        <t:select attr="X-Test-Header" emptyset="0" />
      </t:restServletResponse>
    </t:resttest>

  </t:test_case>  
  
</t:tests>

