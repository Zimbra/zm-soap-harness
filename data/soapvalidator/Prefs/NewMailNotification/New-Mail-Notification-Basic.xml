<t:tests xmlns:t="urn:zimbraTestHarness">

<t:property name="base1.name" value="base${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="notification1.address" value="notify${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="sender1.name" value="sender${TIME}.${COUNTER}@${defaultdomain.name}"/>
<t:property name="base2.name" value="base${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="notification2.address" value="notify${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="sender2.name" value="sender${TIME}.${COUNTER}@${defaultdomain.name}"/>
<t:property name="base3.name" value="base${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="notification3.address" value="notify${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="sender3.name" value="sender${TIME}.${COUNTER}@${defaultdomain.name}"/>
<t:property name="base4.name" value="base${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="notification4.address" value="notify${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="base5.name" value="base${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="notification5.address" value="notify${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="base6.name" value="base${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="sender6.name" value="sender${TIME}.${COUNTER}@${defaultdomain.name}"/>
<t:property name="notification6.address" value="notify${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="base7.name" value="base${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="sender7.name" value="sender${TIME}.${COUNTER}@${defaultdomain.name}"/>    
<t:property name="base8.name" value="base${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="sender8.name" value="sender${TIME}.${COUNTER}@${defaultdomain.name}"/>
<t:property name="base9.name" value="base${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="sender9.name" value="sender${TIME}.${COUNTER}@${defaultdomain.name}"/>
<t:property name="notification9.address" value="notify${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="base10.name" value="base${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="sender10.name" value="sender${TIME}.${COUNTER}@${defaultdomain.name}"/>
<t:property name="notification10.address" value="notify${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="base10.name" value="base${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="sender10.name" value="sender${TIME}.${COUNTER}@${defaultdomain.name}"/>
<t:property name="notification10.address" value="notify${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="base11.name" value="base${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="sender11.name" value="sender${TIME}.${COUNTER}@${defaultdomain.name}"/>
<t:property name="notification11.address" value="notify${TIME}${COUNTER}@${defaultdomain.name}"/>
<t:property name="notification11b.address" value="notify${TIME}${COUNTER}@${defaultdomain.name}"/>

<t:property name="message1.subject" value="subject1.${TIME}.${COUNTER}"/>
<t:property name="message1.content" value="content1.${TIME}.${COUNTER}"/>
<t:property name="message2.subject" value="subject1.${TIME}.${COUNTER}"/>
<t:property name="message2.content" value="content1.${TIME}.${COUNTER}"/>
<t:property name="message3.subject" value="subject1.${TIME}.${COUNTER}"/>
<t:property name="message3.content" value="content1.${TIME}.${COUNTER}"/>
<t:property name="message4.subject" value="subject1.${TIME}.${COUNTER}"/>
<t:property name="message4.content" value="content1.${TIME}.${COUNTER}"/>
<t:property name="message5.subject" value="subject1.${TIME}.${COUNTER}"/>
<t:property name="message5.content" value="content1.${TIME}.${COUNTER}"/>
<t:property name="message6.subject" value="subject1.${TIME}.${COUNTER}"/>
<t:property name="message6.content" value="content1.${TIME}.${COUNTER}"/>
<t:property name="message7.subject" value="subject1.${TIME}.${COUNTER}"/>
<t:property name="message7.content" value="content1.${TIME}.${COUNTER}"/>
<t:property name="message8.subject" value="subject1.${TIME}.${COUNTER}"/>
<t:property name="message8.content" value="content1.${TIME}.${COUNTER}"/>    
<t:property name="message9.subject" value="subject1.${TIME}.${COUNTER}"/>
<t:property name="message9.content" value="content1.${TIME}.${COUNTER}"/>
<t:property name="message10.subject" value="subject1.${TIME}.${COUNTER}"/>
<t:property name="message10.content" value="content1.${TIME}.${COUNTER}"/>
<t:property name="message11.subject" value="subject1.${TIME}.${COUNTER}"/>
<t:property name="message11.content" value="content1.${TIME}.${COUNTER}"/>
<t:property name="message12.subject" value="subject1.${TIME}.${COUNTER}"/>
<t:property name="message12.content" value="content1.${TIME}.${COUNTER}"/>    

<t:property name="appointment1.subject" value="Subject of meeting${TIME}.${COUNTER}"/>
<t:property name="appointment.location" value="Location of meeting${TIME}.${COUNTER}"/>
<t:property name="appointment.content" value="Content of the message${TIME}.${COUNTER}"/>
<t:property name="Time1" value="${ICALTIME(+30m)}"/>
<t:property name="Time2" value="${ICALTIME(+1h)}"/>
    
<t:property name="server.zimbraAdmin" value="${zimbraServer.name}"/>
<t:property name="test_acct-b1.server" value="NOT_DEFINED"/>
<t:property name="test_acct-b2.server" value="NOT_DEFINED"/>
<t:property name="test_acct-b3.server" value="NOT_DEFINED"/>
<t:property name="test_acct-b4.server" value="NOT_DEFINED"/>
<t:property name="test_acct-b5.server" value="NOT_DEFINED"/>
<t:property name="test_acct-b6.server" value="NOT_DEFINED"/>
<t:property name="test_acct-b7.server" value="NOT_DEFINED"/>
<t:property name="test_acct-b8.server" value="NOT_DEFINED"/>
<t:property name="test_acct-b9.server" value="NOT_DEFINED"/>
<t:property name="test_acct-b10.server" value="NOT_DEFINED"/>
<t:property name="test_acct-b11.server" value="NOT_DEFINED"/>
<t:property name="test_acct-s1.server" value="NOT_DEFINED"/>
<t:property name="test_acct-s2.server" value="NOT_DEFINED"/>
<t:property name="test_acct-s3.server" value="NOT_DEFINED"/>
<t:property name="test_acct-s4.server" value="NOT_DEFINED"/>
<t:property name="test_acct-s5.server" value="NOT_DEFINED"/>
<t:property name="test_acct-s6.server" value="NOT_DEFINED"/>
<t:property name="test_acct-s7.server" value="NOT_DEFINED"/>
<t:property name="test_acct-s8.server" value="NOT_DEFINED"/>
<t:property name="test_acct-s9.server" value="NOT_DEFINED"/>
<t:property name="test_acct-s10.server" value="NOT_DEFINED"/>
<t:property name="test_acct-s11.server" value="NOT_DEFINED"/>
<t:property name="test_acct-n1.server" value="NOT_DEFINED"/>
<t:property name="test_acct-n2.server" value="NOT_DEFINED"/>
<t:property name="test_acct-n3.server" value="NOT_DEFINED"/>
<t:property name="test_acct-n4.server" value="NOT_DEFINED"/>
<t:property name="test_acct-n5.server" value="NOT_DEFINED"/>
<t:property name="test_acct-n6.server" value="NOT_DEFINED"/>
<t:property name="test_acct-n7.server" value="NOT_DEFINED"/>
<t:property name="test_acct-n8.server" value="NOT_DEFINED"/>
<t:property name="test_acct-n9.server" value="NOT_DEFINED"/>
<t:property name="test_acct-n10.server" value="NOT_DEFINED"/>
<t:property name="test_acct-n11.server" value="NOT_DEFINED"/>
<t:property name="test_acct-n11b.server" value="NOT_DEFINED"/>



<!-- authentication -->
<t:test_case testcaseid="Ping" type="always">
    <t:objective>basic system check</t:objective>

    <t:test id="ping" required="true">
        <t:request>
            <PingRequest xmlns="urn:zimbraAdmin"/>
        </t:request>
        <t:response>
            <t:select path="//admin:PingResponse"/>
        </t:response>
    </t:test>

</t:test_case>


<!-- Login as the admin to get an auth token -->
<t:test_case testcaseid="acctSetup1_NewMailNotification" type="always">
    <t:objective>create test account</t:objective>
    <t:steps>1. Login to admin.
            2. Create a test account.
    </t:steps>

	<t:property name="server.zimbraAdmin" value="${zimbraServer.name}"/>

    <t:test id="admin_login" required="true" depends="ping">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAdmin">
                <name>${admin.user}</name>
                <password>${admin.password}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:AuthResponse/admin:authToken" set="authToken"/>
        </t:response>
    </t:test>
     
    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${base1.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="base1.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-b1.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${sender1.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="sender1.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-s1.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${notification1.address}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="notification1.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-n1.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${base2.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="base2.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-b2.server"/>
        </t:response>
    </t:test>

    <t:test required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${sender2.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="sender2.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-s2.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${notification2.address}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="notification2.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-n2.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${base3.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="base3.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-b3.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${sender3.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="sender3.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-s3.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${notification3.address}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="notification3.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-n3.server"/>
        </t:response>
    </t:test>  

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${base4.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="base4.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-b4.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${notification4.address}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="notification4.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-n4.server"/>
        </t:response>
    </t:test> 

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${base5.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="base5.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-b5.server"/>
        </t:response>
    </t:test>   

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${notification5.address}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="notification5.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-n5.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${base6.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="base6.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-b6.server"/>
        </t:response>
    </t:test>

    <t:test required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${sender6.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="sender6.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-s6.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${notification6.address}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="notification6.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-n6.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${base7.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="base7.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct.server"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-b7.server"/>
        </t:response>
    </t:test>

    <t:test required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${sender7.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="sender7.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-s7.server"/>

        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${base8.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="base8.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-b8.server"/>
        </t:response>
    </t:test>

    <t:test required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${sender8.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="sender8.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-s8.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${base9.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="base9.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-b9.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${base10.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="base10.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-b10.server"/>
        </t:response>
    </t:test>

    <t:test required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${sender10.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="sender10.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-s10.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${notification10.address}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="notification10.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-n10.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${base11.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="base11.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-b11.server"/>
        </t:response>
    </t:test>

    <t:test required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${sender11.name}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="sender11.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-s11.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${notification11.address}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="notification11.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-n11.server"/>
        </t:response>
    </t:test>

    <t:test  required="true">
        <t:request>
            <CreateAccountRequest xmlns="urn:zimbraAdmin">
                <name>${notification11b.address}</name>
                <password>${defaultpassword.value}</password>
            </CreateAccountRequest>
        </t:request>
        <t:response>
            <t:select path="//admin:CreateAccountResponse/admin:account" attr="id"  set="notification11b.id"/>
            <t:select path='//admin:CreateAccountResponse/admin:account/admin:a[@n="zimbraMailHost"]' set="test_acct-n11b.server"/>
        </t:response>
    </t:test>
    
</t:test_case>    
    
<t:property name="server.zimbraAccount" value="${test_acct-b1.server}"/>
    
<t:test_case testcaseid="NewMailNotificationBasic01" type="smoke">
    <t:objective>Verify that new mail notification setting send automatic notification mail </t:objective>
    <t:steps>
        1. Login to account1.
        2. Modify the Preferences to set the Nofications.
        3. Verify that zimbraPrefNewMailNotificationAddress = Notification1.address
        4. Verify that zimbraPrefNewMailNotificationEnabled = True
        5. Login to Account2.
        6. Send mail to Account1.
        7. Login to Account1
        8. Verify new mail comes to account1 from Account2
        9. Login to Mail-notification account
        10. Verify notification mail for new mail comes to Mail-notification account
    </t:steps>

    <t:test id="newMailNotificationBasic01a">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base1.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic01b" depends="newMailNotificationBasic01a">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.true}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress">${notification1.address}</pref>
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic01c" depends="newMailNotificationBasic01b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="${notification1.address}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic01d" depends="newMailNotificationBasic01b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationEnabled']" match="${globals.true}"/>
            </t:select>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-s1.server}"/>

    <t:test id="newMailNotificationBasic01e">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${sender1.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic01f" depends="newMailNotificationBasic01e">
        <t:request>
            <SendMsgRequest xmlns="urn:zimbraMail">
                <m>
                    <e t="t" a='${base1.name}'/>
                    <su>${message1.subject}</su>
                    <mp ct="text/plain">
                        <content>${message1.content}</content>
                    </mp>
                </m>
            </SendMsgRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SendMsgResponse"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-b1.server}"/>

    <t:test id="newMailNotificationBasic01g">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base1.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic01h" depends="newMailNotificationBasic01f">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> subject:(${message1.subject}) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-n1.server}"/>

    <t:test id="newMailNotificationBasic01i">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${notification1.address}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic01j" depends="newMailNotificationBasic01c,newMailNotificationBasic01d,newMailNotificationBasic01f">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(inbox) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match=".*New message received at ${base1.name}.*"/>            
        </t:response>
    </t:test>

</t:test_case>    
    
    
<t:test_case testcaseid="NewMailNotificationBasic02" type="sanity">
    <t:objective>Verify automatic notification mail is sent for a replied mail </t:objective>
    <t:steps>
        1. Login to account1.
        2. Modify the Preferences to set the Nofications.
        3. Verify that zimbraPrefNewMailNotificationAddress = notification3.address
        4. Verify that zimbraPrefNewMailNotificationEnabled = True
        5. Send a mail to account2
        6. Login to Account2.
        7. Reply the mail back to Account1.
        8. Login to Account1
        9. Verify new mail comes to Account1 from Account2
        10. Login to Mail-notification account
        11. Verify notification mail for new mail comes to Mail-notification account
    </t:steps>

<t:property name="server.zimbraAccount" value="${test_acct-b2.server}"/>

    <t:test id="newMailNotificationBasic02a">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base2.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic02b" depends="newMailNotificationBasic02a">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.true}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress">${notification2.address}</pref>
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic02c" depends="newMailNotificationBasic02b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="${notification2.address}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic02d" depends="newMailNotificationBasic02b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationEnabled']" match="${globals.true}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic02e">
        <t:request>
            <SendMsgRequest xmlns="urn:zimbraMail">
                <m>
                    <e t="t" a='${sender2.name}'/>
                    <su>${message2.subject}</su>
                    <mp ct="text/plain">
                        <content>${message2.content}</content>
                    </mp>
                </m>
            </SendMsgRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SendMsgResponse"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-s2.server}"/>
    
    <t:test>
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${sender2.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic02f" depends="newMailNotificationBasic02e">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> subject:(${message2.subject}) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m" attr="id" set="msg2.id"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic02g" depends="newMailNotificationBasic02f">
        <t:request>
            <SendMsgRequest xmlns="urn:zimbraMail">
                <m origid="${msg2.id}" rt="r">
                    <e t="t" a='${base2.name}'/>
                    <su>Re: ${message2.subject}</su>
                    <mp ct="text/plain">
                        <content>${message2.content}</content>
                    </mp>
                </m>
            </SendMsgRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SendMsgResponse"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-b2.server}"/>

    <t:test id="newMailNotificationBasic02h">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base2.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic02i" depends="newMailNotificationBasic02g">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> subject:(${message2.subject}) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-n2.server}"/>

    <t:test id="newMailNotificationBasic02j">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${notification2.address}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic02k" depends="newMailNotificationBasic02c,newMailNotificationBasic02d,newMailNotificationBasic02g">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(inbox) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match=".*New message received at ${base2.name}.*"/>            
        </t:response>
    </t:test>

</t:test_case>    
    

<t:test_case testcaseid="NewMailNotificationBasic03" type="sanity">
    <t:objective>Verify automatic notification mail is sent for a forwarded mail </t:objective>
    <t:steps>
        1. Login to account1.
        2. Modify the Preferences to set the Nofications.
        3. Verify that zimbraPrefNewMailNotificationAddress = notification3.address
        4. Verify that zimbraPrefNewMailNotificationEnabled = True
        5. Send a mail to account2
        6. Login to Account2.
        7. Forward the mail to Account1.
        8. Login to Account1
        9. Verify new mail comes to Account1 from Account2
        10. Login to Mail-notification account
        11. Verify notification mail for new mail comes to Mail-notification account
    </t:steps>

<t:property name="server.zimbraAccount" value="${test_acct-b3.server}"/>

    <t:test id="newMailNotificationBasic03a">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base3.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic03b" depends="newMailNotificationBasic03a">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.true}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress">${notification3.address}</pref>
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic03c" depends="newMailNotificationBasic03b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="${notification3.address}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic03d" depends="newMailNotificationBasic03b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationEnabled']" match="${globals.true}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic03e">
        <t:request>
            <SendMsgRequest xmlns="urn:zimbraMail">
                <m>
                    <e t="t" a='${sender3.name}'/>
                    <su>${message3.subject}</su>
                    <mp ct="text/plain">
                        <content>${message3.content}</content>
                    </mp>
                </m>
            </SendMsgRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SendMsgResponse"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-s3.server}"/>
    
    <t:test>
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${sender3.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic03f" depends="newMailNotificationBasic03e">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> subject:(${message3.subject}) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m" attr="id" set="msg3.id"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic03g" depends="newMailNotificationBasic03f">
        <t:request>
            <SendMsgRequest xmlns="urn:zimbraMail">
                <m origid="${msg3.id}" rt="w">
                    <e t="t" a='${base3.name}'/>
                    <su>Fw: ${message3.subject}</su>
                    <mp ct="text/plain">
                        <content>${message3.content}</content>
                    </mp>
                </m>
            </SendMsgRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SendMsgResponse"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-b3.server}"/>

    <t:test id="newMailNotificationBasic03h">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base3.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic03i" depends="newMailNotificationBasic03g">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> subject:(${message3.subject}) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-n3.server}"/>

    <t:test id="newMailNotificationBasic03j">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${notification3.address}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic03k" depends="newMailNotificationBasic03c,newMailNotificationBasic03d,newMailNotificationBasic03g">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(inbox) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match=".*New message received at ${base3.name}.*"/>            
        </t:response>
    </t:test>

</t:test_case>  
    
    
<t:test_case testcaseid="NewMailNotificationBasic04" type="sanity">
    <t:objective>Verify automatic notification mail is obtained for a mail which is sent to self </t:objective>
    <t:steps>
        1. Login to account1.
        2. Modify the Preferences to set the Nofications and to get the mail sent to self as normal.
        3. Verify that zimbraPrefNewMailNotificationAddress = notification4.address
        4. Verify that zimbraPrefNewMailNotificationEnabled = True
        5. Send mail to to itself.
        6. Login to Mail-notification account
        7. Verify notification mail for new mail comes to Mail-notification account
    </t:steps>

<t:property name="server.zimbraAccount" value="${test_acct-b4.server}"/>

    <t:test id="newMailNotificationBasic04a">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base4.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic04b" depends="newMailNotificationBasic04a">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.true}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress">${notification4.address}</pref>
                <pref name="zimbraPrefDedupeMessagesSentToSelf">dedupeNone</pref>
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic04c" depends="newMailNotificationBasic04b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="${notification4.address}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic04d" depends="newMailNotificationBasic04b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationEnabled']" match="${globals.true}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic04e">
        <t:request>
            <SendMsgRequest xmlns="urn:zimbraMail">
                <m>
                    <e t="t" a='${base4.name}'/>
                    <su>${message4.subject}</su>
                    <mp ct="text/plain">
                        <content>${message4.content}</content>
                    </mp>
                </m>
            </SendMsgRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SendMsgResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic04f" depends="newMailNotificationBasic04e">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(${globals.inbox}) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match="${message4.subject}"/>
        </t:response>
    </t:test>        

<t:property name="server.zimbraAccount" value="${test_acct-n4.server}"/>

    <t:test id="newMailNotificationBasic04g">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${notification4.address}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test depends="newMailNotificationBasic04c,newMailNotificationBasic04d,newMailNotificationBasic04e">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(inbox) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match=".*New message received at ${base4.name}.*"/>            
        </t:response>
    </t:test>

</t:test_case>      
 
 
<t:test_case testcaseid="NewMailNotificationBasic05" type="sanity">
    <t:objective>Verify that it does not loop if account1's mail notification address is account3 and vice versa </t:objective>
    <t:steps>
        1. Login to account1.
        2. Modify the Preferences to set the Nofications.
        3. Verify that zimbraPrefNewMailNotificationAddress = notification5.address
        4. Verify that zimbraPrefNewMailNotificationEnabled = True
        5. Login to notification5.address.
        2. Modify the Preferences to set the Nofications.
        3. Verify that zimbraPrefNewMailNotificationAddress = base5.address
        4. Verify that zimbraPrefNewMailNotificationEnabled = True
        6. Send mail to Account1 (base5.address).
        7. Login to Account1 (base5.address)
        8. Verify the mail is received
        9. Verify that no notification is received
        10. Login to Mail-notification account
        11. Verify that the notification for a mail in base5 is received.
    </t:steps>

<t:property name="server.zimbraAccount" value="${test_acct-b5.server}"/>

    <t:test id="newMailNotificationBasic05a">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base5.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic05b" depends="newMailNotificationBasic05a">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.true}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress">${notification5.address}</pref>                
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic05c" depends="newMailNotificationBasic05b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="${notification5.address}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic05d" depends="newMailNotificationBasic05b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationEnabled']" match="${globals.true}"/>
            </t:select>
        </t:response>
    </t:test> 

<t:property name="server.zimbraAccount" value="${test_acct-n5.server}"/>

    <t:test id="newMailNotificationBasic05e">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${notification5.address}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>
    
    <t:test id="newMailNotificationBasic05f" depends="newMailNotificationBasic05e">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.true}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress">${base5.name}</pref>                
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic05g" depends="newMailNotificationBasic05f">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="${base5.name}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic05h" depends="newMailNotificationBasic05f">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationEnabled']" match="${globals.true}"/>
            </t:select>
        </t:response>
    </t:test>
    
    <t:test id="newMailNotificationBasic05i">
        <t:request>
            <SendMsgRequest xmlns="urn:zimbraMail">
                <m>
                    <e t="t" a='${base5.name}'/>
                    <su>${message5.subject}</su>
                    <mp ct="text/plain">
                        <content>${message5.content}</content>
                    </mp>
                </m>
            </SendMsgRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SendMsgResponse"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-b5.server}"/>
    
    <t:test id="newMailNotificationBasic05j">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base5.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>
    
    <t:test id="newMailNotificationBasic05k" depends="newMailNotificationBasic05i,newMailNotificationBasic05j">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(${globals.inbox}) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match="${message5.subject}"/>
        </t:response>
    </t:test>  

    <t:test>
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(inbox) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match=".*New message received at*" emptyset="1"/>            
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-n5.server}"/>

    <t:test id="newMailNotificationBasic05l">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${notification5.address}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test depends="newMailNotificationBasic05b,newMailNotificationBasic05l">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(inbox) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match=".*New message received at ${base5.name}.*"/>
        </t:response>
    </t:test>

</t:test_case>   
    
    
<t:test_case testcaseid="NewMailNotificationBasic06" type="bhr">
    <t:objective>Verify that new mail notification setting can be reset to false </t:objective>
    <t:steps>
        1. Login to account1.
        2. Modify the Preferences to set the Nofications.
        3. Verify that zimbraPrefNewMailNotificationAddress = notification6.address
        4. Verify that zimbraPrefNewMailNotificationEnabled = True
        5. Modify the Preferences again to reset the Nofications to false.
        6. Verify that zimbraPrefNewMailNotificationAddress = empty
        7. Verify that zimbraPrefNewMailNotificationEnabled = False
        8. Login to Account2.
        9. Send mail to Account1.
        10. Verify new mail comes to Account1 from Account2
        11. Login to Mail-notification account
        12. Verify notification mail for new mail doe not come to Mail-notification account
    </t:steps>

<t:property name="server.zimbraAccount" value="${test_acct-b6.server}"/>

    <t:test id="newMailNotificationBasic06a">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base6.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic06b" depends="newMailNotificationBasic06a">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.true}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress">${notification6.address}</pref>
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic06c" depends="newMailNotificationBasic06b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="${notification6.address}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic06d" depends="newMailNotificationBasic06b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationEnabled']" match="${globals.true}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic06e" depends="newMailNotificationBasic06a">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.false}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress"></pref>
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic06f" depends="newMailNotificationBasic06e">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="^${notification6.address}$" emptyset="1"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic06g" depends="newMailNotificationBasic06e">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationEnabled']" match="${globals.false}"/>
            </t:select>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-s6.server}"/>

    <t:test id="newMailNotificationBasic06h">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${sender6.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic06i" depends="newMailNotificationBasic06h">
        <t:request>
            <SendMsgRequest xmlns="urn:zimbraMail">
                <m>
                    <e t="t" a='${base6.name}'/>
                    <su>${message6.subject}</su>
                    <mp ct="text/plain">
                        <content>${message6.content}</content>
                    </mp>
                </m>
            </SendMsgRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SendMsgResponse"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-b6.server}"/>

    <t:test id="newMailNotificationBasic06j">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base6.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic06k" depends="newMailNotificationBasic06h">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> subject:(${message6.subject}) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-n6.server}"/>

    <t:test id="newMailNotificationBasic06l">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${notification6.address}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic06m" depends="newMailNotificationBasic06e,newMailNotificationBasic06l">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(inbox) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match=".*New message received at ${base6.name}.*" emptyset="1"/>            
        </t:response>
    </t:test>

</t:test_case>   
    
   
<t:test_case testcaseid="NewMailNotificationBasic07" type="sanity">
    <t:objective>Verify setting the automatic notification mail address to self </t:objective>
    <t:steps>
        1. Login to account1.
        2. Modify the Preferences to set the Nofications and to get the mail sent to self as normal.
        3. Verify that zimbraPrefNewMailNotificationAddress = account1
        4. Verify that zimbraPrefNewMailNotificationEnabled = True
        5. Login to account2
        6. Send mail to account1.
        7. Login to account1.
        8. Verify account1 get the mail.
        9. Verify account1 gets the notification mail
    </t:steps>

<t:property name="server.zimbraAccount" value="${test_acct-b7.server}"/>

    <t:test id="newMailNotificationBasic07a">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base7.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic07b" depends="newMailNotificationBasic07a">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.true}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress">${base7.name}</pref>
                <pref name="zimbraPrefDedupeMessagesSentToSelf">dedupeNone</pref>
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic07c" depends="newMailNotificationBasic07b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="${base7.name}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic07d" depends="newMailNotificationBasic07b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationEnabled']" match="${globals.true}"/>
            </t:select>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-s7.server}"/>

    <t:test id="newMailNotificationBasic07e">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${sender7.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic07f">
        <t:request>
            <SendMsgRequest xmlns="urn:zimbraMail">
                <m>
                    <e t="t" a='${base7.name}'/>
                    <su>${message7.subject}</su>
                    <mp ct="text/plain">
                        <content>${message7.content}</content>
                    </mp>
                </m>
            </SendMsgRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SendMsgResponse"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-b7.server}"/>

    <t:test id="newMailNotificationBasic07g">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base7.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic07h" depends="newMailNotificationBasic07f">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(${globals.inbox}) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match="${message7.subject}"/>
        </t:response>
    </t:test>        

    <t:test depends="newMailNotificationBasic07c,newMailNotificationBasic07f" delay="${postfixdelay.msec}">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(inbox) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match=".*New message received at ${base7.name}.*"/>            
        </t:response>
    </t:test>

</t:test_case>    
 
  
<t:test_case testcaseid="NewMailNotificationBasic08" type="sanity">
    <t:objective> Verify setting the automatic notification mail address to self is obtained for mails from account2 when zimbraPrefDedupeMessagesSentToSelf = dedupeAll (do not receive)</t:objective>
    <t:steps>
        1. Login to account1.
        2. Modify the Preferences to set the Nofications and not to get the mail which is sent to self .
        3. Verify that zimbraPrefNewMailNotificationAddress = account1
        4. Verify that zimbraPrefNewMailNotificationEnabled = True
        5. Login to account2
        6. Send mail to account1.
        7. Login to account1.
        8. Verify account1 get the mail.
        9. Verify account1 gets the notification mail
    </t:steps>

<t:property name="server.zimbraAccount" value="${test_acct-b8.server}"/>

    <t:test id="newMailNotificationBasic08a">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base8.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic08b" depends="newMailNotificationBasic08a">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefDedupeMessagesSentToSelf">dedupeAll</pref>
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.true}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress">${base8.name}</pref>                
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic08c" depends="newMailNotificationBasic08b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="${base8.name}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic08d" depends="newMailNotificationBasic08b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
            <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationEnabled']" match="${globals.true}"/>
            </t:select>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-s8.server}"/>

    <t:test id="newMailNotificationBasic08e">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${sender8.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic08f">
        <t:request>
            <SendMsgRequest xmlns="urn:zimbraMail">
                <m>
                    <e t="t" a='${base8.name}'/>
                    <su>${message8.subject}</su>
                    <mp ct="text/plain">
                        <content>${message8.content}</content>
                    </mp>
                </m>
            </SendMsgRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SendMsgResponse"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-b8.server}"/>

    <t:test id="newMailNotificationBasic08g">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base8.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic08h" depends="newMailNotificationBasic08f">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(${globals.inbox}) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match="${message8.subject}"/>
        </t:response>
    </t:test>        

    <t:test depends="newMailNotificationBasic08c,newMailNotificationBasic08f">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(inbox) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match=".*New message received at ${base8.name}.*"/>            
        </t:response>
    </t:test>

</t:test_case>  
    
  
<t:test_case testcaseid="newMailNotificationBasic09" type="sanity">
    <t:objective> Verify setting the automatic notification mail address to self is obtained for mails from account1 to itself when zimbraPrefDedupeMessagesSentToSelf = dedupeAll (do not receive)</t:objective>
    <t:steps>
        1. Login to account1.
        2. Modify the Preferences to set the Nofications and not to get the mail which is sent to self .
        3. Verify that zimbraPrefNewMailNotificationAddress = account1
        4. Verify that zimbraPrefNewMailNotificationEnabled = True
        5. Login to account2
        6. Send mail to account1.
        7. Login to account1.
        8. Verify account1 get the mail.
        9. Verify account1 gets the notification mail
    </t:steps>

<t:property name="server.zimbraAccount" value="${test_acct-b9.server}"/>

    <t:test id="newMailNotificationBasic09a">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base9.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic09b" depends="newMailNotificationBasic09a">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefDedupeMessagesSentToSelf">dedupeAll</pref>
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.true}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress">${base9.name}</pref>                
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic09c" depends="newMailNotificationBasic09b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="${base9.name}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic09d" depends="newMailNotificationBasic09b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
            <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationEnabled']" match="${globals.true}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic09e">
        <t:request>
            <SendMsgRequest xmlns="urn:zimbraMail">
                <m>
                    <e t="t" a='${base9.name}'/>
                    <su>${message9.subject}</su>
                    <mp ct="text/plain">
                        <content>${message9.content}</content>
                    </mp>
                </m>
            </SendMsgRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SendMsgResponse"/>
        </t:response>
    </t:test>
    
    <t:test id="newMailNotificationBasic09f" depends="newMailNotificationBasic09e">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(${globals.inbox}) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match="${message9.subject}" emptyset="1"/>
        </t:response>
    </t:test>        

    <t:test depends="newMailNotificationBasic09e">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(inbox) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match=".*New message received at ${base9.name}.*" emptyset="1"/>            
        </t:response>
    </t:test>

</t:test_case>      
    

<t:test_case testcaseid="NewMailNotificationBasic10" type="sanity">
    <t:objective> Verify the automatic notification mail when account1 gets an appointment invitation </t:objective>
    <t:steps>
        1. Login to account1.
        2. Modify the Preferences to set the Nofications.
        3. Verify that zimbraPrefNewMailNotificationAddress = account1
        4. Verify that zimbraPrefNewMailNotificationEnabled = True
        5. Login to account2
        6. Send an appintment invitation to account1 .
        7. Login to account1.
        8. Verify account1 get the mail.
        9. Login to Mail-notifiction account.
        10 Verify Mail-notifiction account gets the notification mail.
    </t:steps>

<t:property name="server.zimbraAccount" value="${test_acct-b10.server}"/>

    <t:test id="newMailNotificationBasic10a">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base10.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic10b" depends="newMailNotificationBasic10a">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">                
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.true}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress">${notification10.address}</pref>                
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic10c" depends="newMailNotificationBasic10b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="${notification10.address}"/>
            </t:select>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic10d" depends="newMailNotificationBasic10b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
            <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationEnabled']" match="${globals.true}"/>
            </t:select>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-s10.server}"/>

    <t:test id="newMailNotificationBasic10e">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${sender10.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic10f">
        <t:request>
            <CreateAppointmentRequest xmlns="urn:zimbraMail">
                <m>
                    <inv method="REQUEST" type="event" fb="B" transp="O" allDay="0" name="${appointment1.subject}" loc="${appointment.location}">
                        <at role="OPT" ptst="NE" rsvp="1" a="${base10.name}"/>
                        <s d="${Time1}"/>
                        <e d="${Time2}"/>
                        <or a="${sender10.name}"/>
                    </inv>
                    <e a="${base10.name}" t="t"/>
                    <mp content-type="text/plain">
                        <content>${appointment.content}</content>
                    </mp>
                    <su>${appointment1.subject}</su>
                </m>
            </CreateAppointmentRequest>
        </t:request>
        <t:response>
            <t:select path = "//mail:CreateAppointmentResponse"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-b10.server}"/>

    <t:test id="newMailNotificationBasic10g">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base10.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic10h" depends="newMailNotificationBasic10f">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(${globals.inbox}) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match="${appointment1.subject}"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-n10.server}"/>

    <t:test id="newMailNotificationBasic10i" delay="${postfixdelay.msec}">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${notification10.address}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test depends="newMailNotificationBasic10f,newMailNotificationBasic10i">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(inbox) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match=".*New message received at ${base10.name}.*"/>            
        </t:response>
    </t:test>

</t:test_case> 
    

<t:test_case testcaseid="NewMailNotificationBasic11" type="sanity">
    <t:objective> Verify the automatic notification is given to proper account if notification address is changed </t:objective>
    <t:steps>
        1. Login to account1.
        2. Modify the Preferences to set the Nofications to Notification-account1.
        3. Verify that zimbraPrefNewMailNotificationAddress = account1
        4. Modify the Preferences to set the Nofications-account2.
        5. Login to account2
        6. Send an a mail to account1 .
        7. Login to account1.
        8. Verify account1 get the mail.
        9. Login to Mail-notifiction account1.
        10. Verify Mail-notifiction account1 does not get the notification mail.
        11. Verify Mail-notifiction account2 gets the notification mail.
    </t:steps>

<t:property name="server.zimbraAccount" value="${test_acct-b11.server}"/>

    <t:test id="newMailNotificationBasic11a">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base11.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic11b" depends="newMailNotificationBasic11a">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">                
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.true}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress">${notification11.address}</pref>                
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic11c" depends="newMailNotificationBasic11b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="${notification11.address}"/>
            </t:select>
        </t:response>
    </t:test>


    <t:test id="newMailNotificationBasic11d" depends="newMailNotificationBasic11a">
        <t:request>
            <ModifyPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationEnabled">${globals.true}</pref>
                <pref name="zimbraPrefNewMailNotificationAddress">${notification11b.address}</pref>
            </ModifyPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:ModifyPrefsResponse"/>
        </t:response>
    </t:test>

    <t:test depends="newMailNotificationBasic11b">
        <t:request>
            <GetPrefsRequest xmlns="urn:zimbraAccount">
                <pref name="zimbraPrefNewMailNotificationAddress"/>
            </GetPrefsRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:GetPrefsResponse">
                <t:select path="acct:pref[@name='zimbraPrefNewMailNotificationAddress']" match="${notification11b.address}"/>
            </t:select>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-s11.server}"/>

    <t:test id="newMailNotificationBasic11e">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${sender11.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic11f">
        <t:request>
            <SendMsgRequest xmlns="urn:zimbraMail">
                <m>
                    <e t="t" a='${base11.name}'/>
                    <su>${message11.subject}</su>
                    <mp ct="text/plain">
                        <content>${message11.content}</content>
                    </mp>
                </m>
            </SendMsgRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SendMsgResponse"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-b11.server}"/>

    <t:test id="newMailNotificationBasic11g">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${base11.name}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test id="newMailNotificationBasic11h" depends="newMailNotificationBasic11f">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(${globals.inbox}) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match="${message11.subject}"/>
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-n11.server}"/>

    <t:test id="newMailNotificationBasic11i" delay="${postfixdelay.msec}">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${notification11.address}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test depends="newMailNotificationBasic11f,newMailNotificationBasic11i">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(inbox) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match=".*New message received at ${base11.name}.*" emptyset="1"/>            
        </t:response>
    </t:test>

<t:property name="server.zimbraAccount" value="${test_acct-n11b.server}"/>

    <t:test id="newMailNotificationBasic11j">
        <t:request>
            <AuthRequest xmlns="urn:zimbraAccount">
                <account by="name">${notification11b.address}</account>
                <password>${defaultpassword.value}</password>
            </AuthRequest>
        </t:request>
        <t:response>
            <t:select path="//acct:AuthResponse/acct:lifetime"  match="^\d+$"/>
            <t:select path="//acct:AuthResponse/acct:authToken" set="authToken"/>

        </t:response>
    </t:test>

    <t:test depends="newMailNotificationBasic11f,newMailNotificationBasic11j">
        <t:request>
            <SearchRequest xmlns="urn:zimbraMail" types="message">
                <query> in:(inbox) </query>
            </SearchRequest>
        </t:request>
        <t:response>
            <t:select path="//mail:SearchResponse/mail:m/mail:su" match=".*New message received at ${base11.name}.*"/>
        </t:response>
    </t:test>

</t:test_case>     
    
</t:tests>
