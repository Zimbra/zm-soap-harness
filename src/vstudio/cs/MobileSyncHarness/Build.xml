<project name="MobileSyncHarness" default="" basedir=".">

  <!-- This ANT BUILD Script is used by Jenkins to package the build and make it available to TMS for distribution -->

  <property environment="env"/>

  <tstamp>
    <format property="archive.id" pattern="yyyy-MM-dd_HH-mm-ss"/>
  </tstamp>

  <!--<property name="P4ROOT"       location="/jenkins/jobs/MobileSyncHarness_Main/workspace/zimbra/main"/>-->
  <!--<property name="ARCHIVEROOT"  location="/jenkins/jobs/MobileSyncHarness_Main/workspace/builds"/>-->
  
  <property name="archive.dir"        location="${ARCHIVEROOT}"/>
  <property name="p4.dir"             location="${P4ROOT}"/>  
  <property name="distribution.dir"   location="${archive.dir}/MobileSyncHarness_${archive.id}"/>
  <property name="easharness_bin.dir" location="${p4.dir}/ZimbraQA/src/vstudio/cs/MobileSyncHarness/EASHarness/bin"/>
  <property name="easharness_obj.dir" location="${p4.dir}/ZimbraQA/src/vstudio/cs/MobileSyncHarness/EASHarness/obj"/>
  <property name="eastests_bin.dir"   location="${p4.dir}/ZimbraQA/src/vstudio/cs/MobileSyncHarness/easTests/bin"/>
  <property name="eastests_obj.dir"   location="${p4.dir}/ZimbraQA/src/vstudio/cs/MobileSyncHarness/easTests/obj"/>
  <property name="release_build.dir"  location="${p4.dir}/ZimbraQA/src/vstudio/cs/MobileSyncHarness/easTests/bin/Release"/>

  <target name="PreMSBuildTask" description = "Before MSBuild triggers clean the Debug/Release build directories and prep for new build process">
    <delete>
      <fileset dir="${easharness_bin.dir}">
        <include name ="*.*"/>
        <type type="file"/>
      </fileset>
    </delete>
    
    <delete>
      <fileset dir="${easharness_obj.dir}">
        <include name ="*.*"/>
        <type type="file"/>
      </fileset>
    </delete>
    
    <delete>
      <fileset dir="${eastests_bin.dir}">
        <include name ="*.*"/>
        <type type="file"/>
      </fileset>
    </delete>

    <delete>
      <fileset dir="${eastests_obj.dir}">
        <include name ="*.*"/>
        <type type="file"/>
      </fileset>
    </delete>
    
    <delete dir="${easharness_bin.dir}"/>
    <delete dir="${easharness_obj.dir}"/>
    <delete dir="${eastests_bin.dir}"/>
    <delete dir="${eastests_obj.dir}"/>
  </target>
  
  <target name="PostMSBuildTask" depends="CompressPackage" description = "After MSBuild completes make the TGZ file ready for SCP/Copy">
    <delete>
      <fileset dir="${distribution.dir}">
        <include name ="*.tar*"/>
        <type type="file"/>
      </fileset>
      <fileset dir="${distribution.dir}">
        <include name ="*.dll*"/>
        <type type="file"/>
      </fileset>     
    </delete>
    
  </target>
  
  <target name="CompressPackage" depends="CreatePackage" description = "Compress distribution package into mobilesyncharness_yyyy-MM-dd_HH-mm-ss.tar.tgz">
    <tar destfile="${distribution.dir}/mobilesyncharness_${archive.id}.tar"   basedir="${distribution.dir}"/>
    <gzip destfile="${distribution.dir}/mobilesyncharness_${archive.id}.tgz"  src="${distribution.dir}/mobilesyncharness_${archive.id}.tar"/>
    <gzip destfile="${archive.dir}/mobilesyncharness.tgz"                     src="${distribution.dir}/mobilesyncharness_${archive.id}.tar"/>
    <checksum file="${archive.dir}/mobilesyncharness.tgz"/>
  </target>

  <target name="CreatePackage" description="Create package for distribution" >
    <mkdir dir="${distribution.dir}"/>
    <copy todir="${distribution.dir}">
      <fileset dir="${release_build.dir}">
        <include name ="*.dll"/>
        <type type="file"/>
      </fileset>
    </copy>
  </target>
  
</project>